import{b as ct}from"./chunk-55E2DFBF.js";import{P as st,c as nt,p as rt,q as ot,s as at,t as N}from"./chunk-6JUBYSQI.js";import{$a as V,Ba as x,Ea as u,Fa as p,G as $,H as E,Hb as tt,Ia as C,J as H,Ja as L,Kb as et,La as W,Ma as Y,Mb as Q,N as b,Na as G,Nb as it,O,Pa as m,Qa as v,Ra as S,T as d,U as h,_a as M,a as D,ca as B,da as s,ea as _,lb as J,mb as P,n as k,pa as f,q as T,ra as l,sb as j,ta as F,tb as K,va as o,wa as a,wb as X,x as A,xa as y,xb as Z,ya as U,za as R}from"./chunk-V45PRMTZ.js";var I=class{constructor(){this.brandId=0,this.typeId=0,this.sort="name",this.pageNumber=1,this.pageSize=6,this.search=""}};var q=(()=>{let n=class n{constructor(e){this.http=e,this.baseUrl=it.apiUrl,this.products=[],this.brands=[],this.types=[],this.shopParams=new I,this.productCache=new Map}getProducts(e=!0){if(e||(this.productCache=new Map),this.productCache.size>0&&e&&this.productCache.has(Object.values(this.shopParams).join("-"))&&(this.pagination=this.productCache.get(Object.values(this.shopParams).join("-")),this.pagination))return k(this.pagination);let t=new X;return this.shopParams.brandId>0&&(t=t.append("brandId",this.shopParams.brandId)),this.shopParams.typeId>0&&(t=t.append("typeId",this.shopParams.typeId)),t=t.append("sort",this.shopParams.sort),t=t.append("pageIndex",this.shopParams.pageNumber),t=t.append("pageSize",this.shopParams.pageSize),this.shopParams.search&&(t=t.append("search",this.shopParams.search)),this.http.get(this.baseUrl+"products",{params:t}).pipe(T(c=>(this.productCache.set(Object.values(this.shopParams).join("-"),c),this.pagination=c,c)))}setShopParams(e){this.shopParams=e}getShopParams(){return this.shopParams}getBrands(){return this.brands.length>0?k(this.brands):this.http.get(this.baseUrl+"products/brands").pipe(T(e=>this.brands=e))}getTypes(){return this.types.length>0?k(this.types):this.http.get(this.baseUrl+"products/types").pipe(T(e=>this.types=e))}getProduct(e){let t=[...this.productCache.values()].reduce((c,g)=>(console.log(c),D(D({},c),g.data.find(z=>z.id===e))),{});return Object.keys(t).length!==0?k(t):this.http.get(this.baseUrl+"products/"+e)}};n.\u0275fac=function(t){return new(t||n)(H(Z))},n.\u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"});let r=n;return r})();function vt(r,n){if(r&1){let i=x();o(0,"div",1)(1,"div",2),y(2,"img",3),o(3,"div",4)(4,"button",5),u("click",function(){d(i);let t=p();return h(t.addItemToBasket())}),a(),o(5,"button",6),m(6," View "),a()()(),o(7,"div",7)(8,"a",8)(9,"h6",9),m(10),a()(),o(11,"span",10),m(12),M(13,"currency"),a()()()}if(r&2){let i=p();s(2),C("alt",i.product.name),C("src",i.product.pictureUrl,B),s(3),L("routerLink","/shop/",i.product.id,""),s(5),S(" ",i.product.name," "),s(2),v(V(13,6,i.product.price))}}var lt=(()=>{let n=class n{constructor(e){this.basketService=e}addItemToBasket(){this.product&&this.basketService.addItemToBasket(this.product)}};n.\u0275fac=function(t){return new(t||n)(_(N))},n.\u0275cmp=b({type:n,selectors:[["app-product-item"]],inputs:{product:"product"},decls:1,vars:1,consts:[["class","card h-100 shadow-sm",4,"ngIf"],[1,"card","h-100","shadow-sm"],[1,"image","position-relative",2,"cursor","pointer"],[1,"img-fluid",3,"alt","src"],[1,"d-flex","align-items-center","justify-content-center","hover-overlay"],[1,"btn","btn-primary","fa","fa-shopping-cart","me-2",3,"click"],[1,"btn","btn-primary",3,"routerLink"],[1,"card-body","d-flex","flex-column"],["href","",1,"text-decoration-none"],[1,"text-uppercase"],[1,"mb-2"]],template:function(t,c){t&1&&f(0,vt,14,8,"div",0),t&2&&l("ngIf",c.product)},dependencies:[P,et,j],styles:[".btn[_ngcontent-%COMP%]{width:30%;height:40px}.image[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover{opacity:1}.image[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover   button[_ngcontent-%COMP%]{transform:none;opacity:1}.hover-overlay[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;background:#ffffff80;opacity:0;transition:all .5s}.hover-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{z-index:1000;transition:all .5s}.hover-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-of-type{transform:translate(-20px)}.hover-overlay[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-of-type{transform:translate(20px)}"]});let r=n;return r})();var xt=["search"];function yt(r,n){if(r&1&&(o(0,"option",21),m(1),a()),r&2){let i=n.$implicit,e=p(2);l("selected",e.shopParams.sort===i.value)("value",i.value),s(),S(" ",i.name," ")}}function St(r,n){if(r&1){let i=x();o(0,"li",22),u("click",function(){let t=d(i).$implicit,c=p(2);return h(c.onBrandSelected(t.id))}),m(1),a()}if(r&2){let i=n.$implicit,e=p(2);F("active",i.id===e.shopParams.brandId),l("value",i.id),s(),S(" ",i.name," ")}}function bt(r,n){if(r&1){let i=x();o(0,"li",22),u("click",function(){let t=d(i).$implicit,c=p(2);return h(c.onTypeSelected(t.id))}),m(1),a()}if(r&2){let i=n.$implicit,e=p(2);F("active",i.id===e.shopParams.typeId),l("value",i.id),s(),v(i.name)}}function Ct(r,n){r&1&&(U(0),o(1,"h1"),m(2,"We do not have products of this type from this manufacturer."),a(),R())}function Pt(r,n){if(r&1&&(o(0,"div",24),y(1,"app-product-item",25),a()),r&2){let i=n.$implicit;s(),l("product",i)}}function It(r,n){if(r&1&&(U(0),f(1,Pt,2,1,"div",23),R()),r&2){let i=p(2);s(),l("ngForOf",i.products)}}function kt(r,n){if(r&1){let i=x();o(0,"div",3)(1,"section",4)(2,"h5",5),m(3,"Sort"),a(),o(4,"select",6),u("change",function(t){d(i);let c=p();return h(c.onSortSelected(t))}),f(5,yt,2,3,"option",7),a(),o(6,"h5",5),m(7," Brands "),a(),o(8,"ul",8),f(9,St,2,4,"li",9),a(),o(10,"h5",5),m(11," Types "),a(),o(12,"ul",8),f(13,bt,2,4,"li",9),a()(),o(14,"section",10)(15,"div",11),y(16,"app-paging-header",12),o(17,"div",13)(18,"input",14,0),u("keyup.enter",function(){d(i);let t=p();return h(t.onSearch())}),a(),o(20,"button",15),u("click",function(){d(i);let t=p();return h(t.onSearch())}),m(21,"Search"),a(),o(22,"button",16),u("click",function(){d(i);let t=p();return h(t.onReset())}),m(23,"Reset"),a()()(),f(24,Ct,3,0,"ng-container",17),o(25,"div",18),f(26,It,2,1,"ng-container",17),a(),o(27,"div",19)(28,"app-pager",20),u("pageChanged",function(t){d(i);let c=p();return h(c.onPageChanged(t))}),a()()()()}if(r&2){let i=p();s(5),l("ngForOf",i.sortOptions),s(4),l("ngForOf",i.brands),s(4),l("ngForOf",i.types),s(3),l("pageNumber",i.shopParams.pageNumber)("pageSize",i.shopParams.pageSize)("totalCount",i.totalCount),s(8),l("ngIf",i.products.length<=0),s(2),l("ngIf",i.products.length>0),s(2),l("pageNumber",i.shopParams.pageNumber)("pageSize",i.shopParams.pageSize)("totalCount",i.totalCount)}}var dt=(()=>{let n=class n{constructor(e){this.shopService=e,this.products=[],this.brands=[],this.types=[],this.sortOptions=[{name:"Alphabetical",value:"name"},{name:"Price: Low to high",value:"priceAsc"},{name:"Price: High to low",value:"priceDesc"}],this.totalCount=0,this.shopParams=e.getShopParams()}ngOnInit(){this.getProducts(),this.getBrands(),this.getTypes()}getProducts(){this.shopService.getProducts().subscribe({next:e=>{this.products=e.data,this.totalCount=e.count},error:e=>console.log(e)})}getBrands(){this.shopService.getBrands().subscribe({next:e=>this.brands=[{id:0,name:"All"},...e],error:e=>console.log(e)})}getTypes(){this.shopService.getTypes().subscribe({next:e=>this.types=[{id:0,name:"All"},...e],error:e=>console.log(e)})}onBrandSelected(e){let t=this.shopService.getShopParams();t.brandId=e,t.pageNumber=1,this.shopService.setShopParams(t),this.shopParams=t,this.getProducts()}onTypeSelected(e){let t=this.shopService.getShopParams();t.typeId=e,t.pageNumber=1,this.shopService.setShopParams(t),this.shopParams=t,this.getProducts()}onSortSelected(e){let t=this.shopService.getShopParams();t.sort=e.target.value,this.shopService.setShopParams(t),this.shopParams=t,this.getProducts()}onPageChanged(e){let t=this.shopService.getShopParams();t.pageNumber!==e&&(t.pageNumber=e,this.shopService.setShopParams(t),this.shopParams=t,this.getProducts())}onSearch(){let e=this.shopService.getShopParams();e.search=this.searchTerm?.nativeElement.value,e.pageNumber=1,this.shopService.setShopParams(e),this.shopParams=e,this.getProducts()}onReset(){this.searchTerm&&(this.searchTerm.nativeElement.value=""),this.shopParams=new I,this.shopService.setShopParams(this.shopParams),this.getProducts()}};n.\u0275fac=function(t){return new(t||n)(_(q))},n.\u0275cmp=b({type:n,selectors:[["app-shop"]],viewQuery:function(t,c){if(t&1&&W(xt,5),t&2){let g;Y(g=G())&&(c.searchTerm=g.first)}},decls:2,vars:1,consts:[["search",""],[1,"container"],["class","row",4,"ngIf"],[1,"row"],[1,"col-3"],[1,"text-warning","ms-3"],[1,"form-select","mb-4",3,"change"],[3,"selected","value",4,"ngFor","ngForOf"],[1,"list-group","my-3"],["class","list-group-item",3,"active","value","click",4,"ngFor","ngForOf"],[1,"col-9"],[1,"d-flex","justify-content-between","align-items-center","pb-2"],[3,"pageNumber","pageSize","totalCount"],[1,"d-flex","mt-2"],["placeholder","Search","type","text",1,"form-control","me-2",3,"keyup.enter"],[1,"btn","btn-outline-primary","mx-2",3,"click"],[1,"btn","btn-outline-success",3,"click"],[4,"ngIf"],[1,"row","row-cols-3","g-3","mb-4"],[1,"d-flex","justify-content-center"],[3,"pageChanged","pageNumber","pageSize","totalCount"],[3,"selected","value"],[1,"list-group-item",3,"click","value"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[3,"product"]],template:function(t,c){t&1&&(o(0,"div",1),f(1,kt,29,11,"div",2),a()),t&2&&(s(),l("ngIf",c.types.length>0&&c.brands.length>0))},dependencies:[J,P,nt,at,rt,ot,lt],styles:[".list-group-item[_ngcontent-%COMP%]{cursor:pointer;border:none;padding:10px 20px;font-size:1.2em}.list-group-item.active[_ngcontent-%COMP%]{border-radius:10px}.list-group-item[_ngcontent-%COMP%]:not(.active):hover{color:#fff;background-color:#008cbab3;border-radius:10px}"]});let r=n;return r})();function wt(r,n){if(r&1&&(o(0,"h5",14),m(1),a()),r&2){let i=p(2);s(),S(" You have ",i.quantityBasket," of this item in your basket ")}}function Tt(r,n){if(r&1){let i=x();o(0,"div",2)(1,"div",3),y(2,"img",4),a(),o(3,"div",5)(4,"h2"),m(5),a(),o(6,"p",6),m(7),M(8,"currency"),a(),f(9,wt,2,1,"h5",7),o(10,"div",8)(11,"i",9),u("click",function(){d(i);let t=p();return h(t.decrementQuantity())}),a(),o(12,"span",10),m(13),a(),o(14,"i",11),u("click",function(){d(i);let t=p();return h(t.incrementQuantity())}),a(),o(15,"button",12),u("click",function(){d(i);let t=p();return h(t.updateBasket())}),m(16),a()(),o(17,"div",13)(18,"h4"),m(19,"Description"),a(),o(20,"p"),m(21),a()()()()}if(r&2){let i=p();s(2),C("alt",i.product.name),C("src",i.product.pictureUrl,B),s(3),v(i.product.name),s(2),v(V(8,9,i.product.price)),s(2),l("ngIf",i.quantityBasket>0),s(4),v(i.quantity),s(2),l("disabled",i.quantity==i.quantityBasket),s(),v(i.buttonText),s(5),v(i.product.description)}}var ht=(()=>{let n=class n{constructor(e,t,c,g){this.shopService=e,this.activatedRoute=t,this.breadcrumbService=c,this.basketService=g,this.quantity=1,this.quantityBasket=0,this.breadcrumbService.set("@productDetails"," ")}get buttonText(){return this.quantityBasket===0?"Add to basket":"Update basket"}ngOnInit(){this.loadProduct()}loadProduct(){let e=this.activatedRoute.snapshot.paramMap.get("id");e&&this.shopService.getProduct(+e).subscribe({next:t=>{this.product=t,this.breadcrumbService.set("@productDetails",t.name),this.basketService.basketSource$.pipe(A(1)).subscribe({next:c=>{let g=c?.items.find(z=>z.id===+e);g&&(this.quantity=g.quantity,this.quantityBasket=g.quantity)}})},error:t=>console.log(t)})}incrementQuantity(){this.quantity++}decrementQuantity(){this.quantity--}updateBasket(){if(this.product)if(this.quantity>this.quantityBasket){let e=this.quantity-this.quantityBasket;this.quantityBasket+=e,this.basketService.addItemToBasket(this.product,e)}else{let e=this.quantityBasket-this.quantity;this.quantityBasket-=e,this.basketService.removeItemFromBasket(this.product.id,e)}}};n.\u0275fac=function(t){return new(t||n)(_(q),_(tt),_(ct),_(N))},n.\u0275cmp=b({type:n,selectors:[["app-product-details"]],decls:2,vars:1,consts:[[1,"container"],["class","row",4,"ngIf"],[1,"row"],[1,"col-6"],[1,"w-100",3,"alt","src"],[1,"col-6","mt-5"],[2,"font-size","2em"],["class","text-primary mb-3",4,"ngIf"],[1,"d-flex","justify-content-start","align-items-center"],[1,"fa","fa-minus-circle","text-warning","me-2",2,"cursor","pointer","font-size","2em",3,"click"],[1,"font-weight-bold",2,"font-size","1.5em"],[1,"fa","fa-plus-circle","text-warning","ms-2",2,"cursor","pointer","font-size","2em",3,"click"],[1,"btn","btn-outline-primary","ms-4",3,"click","disabled"],[1,"row","mt-4"],[1,"text-primary","mb-3"]],template:function(t,c){t&1&&(o(0,"div",0),f(1,Tt,22,11,"div",1),a()),t&2&&(s(),l("ngIf",c.product))},dependencies:[P,j]});let r=n;return r})();var Et=[{path:"",component:dt},{path:":id",component:ht,data:{breadcrumb:{alias:"productDetails"}}}],ut=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=O({type:n}),n.\u0275inj=E({imports:[Q.forChild(Et),Q]});let r=n;return r})();var oe=(()=>{let n=class n{};n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=O({type:n}),n.\u0275inj=E({imports:[K,st,ut]});let r=n;return r})();export{oe as ShopModule};
